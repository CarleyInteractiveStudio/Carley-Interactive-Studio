<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carley Interactive Studio</title>
  <link rel="stylesheet" href="estilos.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const SUPABASE_URL = 'https://rblftfzbqllnuadqtufb.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJibGZ0ZnpicWxsbnVhZHF0dWZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5NjQyMzQsImV4cCI6MjA2ODU0MDIzNH0.cH-KJG2k43dKQaVccQDkw7t6m0sf1zIOLWPADdmKLt8';
    const supabase     = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  </script>
</head>
<body>

<header>
  <h1>Carley Interactive Studio</h1>
  <nav>
    <a href="#bienvenida">Inicio</a>
    <a href="#juegos">Juegos</a>
    <a href="#apoyo">Ap√≥yanos</a>
    <a href="#contacto">Contacto</a>
  </nav>
  <button id="settings-btn" class="gear">‚öôÔ∏è</button>
  <div id="settings-menu" class="menu-oculto">
    <button id="back-btn">Atr√°s</button>
    <button id="login-btn">Iniciar sesi√≥n</button>
    <button id="register-btn">Crear cuenta</button>
    <!-- Bot√≥n de cerrar sesi√≥n se agrega din√°micamente -->
  </div>
</header>

<section id="bienvenida">
  <h2>Bienvenido</h2>
  <p>
    Bienvenido a Carley Interactive Studio, donde la pasi√≥n por los videojuegos y la innovaci√≥n se unen. Sum√©rgete en la acci√≥n con Fire at Will y The Battle of the Capsurers mientras desarrollamos nuestro propio motor: <strong>Creative Engine</strong>.
  </p>
  <p>
    Creative Engine a√∫n est√° en desarrollo. ¬øQuieres aportar tu talento a su creaci√≥n y ayudarnos a contratar m√°s programadores para acelerar el proyecto? ¬°√önete y colabora con nosotros para revolucionar la industria!
  </p>
</section>

<section id="juegos">
  <h2>Juegos Destacados</h2>

  <!-- Battle of the Capsurers -->
  <div class="juego">
    <img src="carley_foto_web/The Battle Of The Capsurers logo.png" alt="The Battle of the Capsurers" class="juego-img" />
    <h3>The Battle of the Capsurers</h3>
    <p>Juego FPS multijugador divertido y emocionante. ¬øEst√°s listo?</p>
    <div class="flex-center">
      <a href="#" class="boton-juego descargar" data-app="The Battle of the Capsurers">Descargar</a>
      <button class="boton-juego" onclick="toggleForm('form-battle')">Soporte</button>
    </div>
    <div id="form-battle" class="formulario-soporte">
      <form action="https://formsubmit.co/empresariacarley16@gmail.com" method="POST">
        <input type="hidden" name="_subject" value="Gmail | Juego: The Battle of the Capsurers" />
        <input type="hidden" name="_captcha" value="false" />
        <input type="hidden" name="_next" value="https://carleyinteractivestudio.github.io/Carley-Interactive-Studio/gracias.html" />
        <input type="email" name="email" placeholder="Tu correo" required />
        <textarea name="mensaje" placeholder="Describe el problema o tu solicitud" required></textarea>
        <button type="submit">Enviar reporte</button>
      </form>
    </div>
  </div>

  <!-- Fire at Will -->
  <div class="juego">
    <img src="carley_foto_web/para fire at will.png" alt="Fire at Will" class="juego-img" />
    <h3>Fire at Will</h3>
    <p>Battle Royale con modos intensos de combate. ¬°Desc√°rgalo ya!</p>
    <div class="flex-center">
      <a href="#" class="boton-juego descargar" data-app="Fire at Will">Descargar</a>
      <button class="boton-juego" onclick="toggleForm('form-fire')">Soporte</button>
    </div>
    <div id="form-fire" class="formulario-soporte">
      <form action="https://formsubmit.co/empresariacarley16@gmail.com" method="POST">
        <input type="hidden" name="_subject" value="Gmail | Juego: Fire at Will" />
        <input type="hidden" name="_captcha" value="false" />
        <input type="hidden" name="_next" value="https://carleyinteractivestudio.github.io/Carley-Interactive-Studio/gracias.html" />
        <input type="email" name="email" placeholder="Tu correo" required />
        <textarea name="mensaje" placeholder="Describe el problema o tu solicitud" required></textarea>
        <button type="submit">Enviar reporte</button>
      </form>
    </div>
  </div>

  <!-- Creative Engine -->
  <div class="juego">
    <img src="imags/Creative Engine.png" alt="Creative Engine" class="juego-img" />
    <h3>Creative Engine</h3>
    <p>Motor para crear tus propios videojuegos. ¬°Pr√≥ximamente disponible!</p>
    <div class="flex-center">
      <a href="#" class="boton-juego descargar" data-app="Creative Engine">Descargar</a>
      <button class="boton-juego" onclick="toggleForm('form-creative')">Soporte</button>
    </div>
    <div id="form-creative" class="formulario-soporte">
      <form action="https://formsubmit.co/empresariacarley16@gmail.com" method="POST">
        <input type="hidden" name="_subject" value="Gmail | Creative Engine" />
        <input type="hidden" name="_captcha" value="false" />
        <input type="hidden" name="_next" value="https://carleyinteractivestudio.github.io/Carley-Interactive-Studio/gracias.html" />
        <input type="email" name="email" placeholder="Tu correo" required />
        <textarea name="mensaje" placeholder="Describe el problema o tu solicitud" required></textarea>
        <button type="submit">Enviar reporte</button>
      </form>
    </div>
  </div>
</section><section id="apoyo">
  <h2>Ap√≥yanos ‚ù§Ô∏è</h2>
  <p>Tu apoyo nos impulsa a seguir creando experiencias incre√≠bles.</p>
  <div id="donate-button-container">
    <div id="donate-button"></div>
    <script src="https://www.paypalobjects.com/donate/sdk/donate-sdk.js" charset="UTF-8"></script>
    <script>
      PayPal.Donation.Button({
        env: 'production',
        hosted_button_id: 'JZ4KM2VUD6AMQ',
        image: {
          src: 'https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif',
          alt: 'Donate with PayPal button',
          title: 'PayPal - The safer, easier way to pay online!'
        }
      }).render('#donate-button');
    </script>
  </div>
  <a href="https://whatsapp.com/channel/0029Vao9B2OJP21CsSXDHL20"
     class="boton-juego" target="_blank">
    √önete a nuestro canal de WhatsApp
  </a>
</section>

<section id="contacto">
  <h2>Contacto üìß</h2>
  <p>¬øTienes ideas, preguntas o quieres colaborar? Env√≠anos un mensaje desde el formulario de soporte t√©cnico.</p>
</section>

<footer>
  <p>&copy; 2025 Carley Interactive Studio</p>
</footer>

<!-- Modales de autenticaci√≥n -->
<div id="modal-backdrop" class="modal-backdrop oculto"></div>

<div id="modal-login" class="modal oculto">
  <h3>Iniciar sesi√≥n</h3>
  <input id="login-email" type="email" placeholder="Email" required>
  <input id="login-password" type="password" placeholder="Contrase√±a" required>
  <button id="login-submit">Entrar</button>
  <a id="open-forgot">¬øOlvidaste tu contrase√±a?</a>
</div>

<div id="modal-register" class="modal oculto">
  <h3>Crear cuenta</h3>
  <input id="reg-email"            type="email"    placeholder="Email" required>
  <input id="reg-password"         type="password" placeholder="Contrase√±a" required>
  <input id="reg-confirm-password" type="password" placeholder="Confirmar contrase√±a" required>
  <input id="reg-phone"            type="tel"      placeholder="Tel√©fono (opcional)">
  <small>Si no agregas tel√©fono, podr√≠as no recuperar tu cuenta en el futuro.</small>
  <button id="register-submit">Registrar y entrar</button>
</div>

<div id="modal-forgot" class="modal oculto">
  <h3>Recuperar contrase√±a</h3>
  <input id="fog-email" type="email" placeholder="Email" required>
  <input id="fog-phone" type="tel"   placeholder="Tel√©fono">
  <button id="fog-request-code">Enviar c√≥digo</button>
  <div id="fog-step2" class="oculto">
    <input id="fog-code" type="text" maxlength="8" placeholder="C√≥digo de 8 d√≠gitos">
    <button id="fog-verify-code">Verificar c√≥digo</button>
  </div>
</div>

<!-- Chat Carley Bot -->
<div id="chat-widget" class="chat-widget oculto">
  <div class="chat-header">
    <img src="imags/Carley Bot.png" alt="Carley Bot" class="bot-avatar">
    <span class="bot-name">Carley Bot</span>
    <button id="chat-close-btn" class="chat-close-btn">‚úñÔ∏è</button>
  </div>
  <div class="chat-body" id="chat-messages"></div>
  <div class="chat-input">
    <input id="chat-input-field" type="text" placeholder="Escribe un mensaje..." />
    <button id="chat-send-btn">Enviar</button>
  </div>
</div>
<button id="chat-open-btn" class="chat-open-btn">üí¨</button><!-- Scripts finales -->
<script>
  // Helpers
  const settingsBtn  = document.getElementById('settings-btn');
  const settingsMenu = document.getElementById('settings-menu');
  const backDrop     = document.getElementById('modal-backdrop');
  const mLogin       = document.getElementById('modal-login');
  const mRegister    = document.getElementById('modal-register');
  const mForgot      = document.getElementById('modal-forgot');

  function toggleModal(modal) {
    const hidden = modal.classList.contains('oculto');
    [modal, backDrop].forEach(el =>
      el.classList.toggle('oculto', !hidden)
    );
  }

  // Men√∫ de opciones
  settingsBtn.onclick = () => {
    const shown = settingsMenu.style.display === 'flex';
    settingsMenu.style.display = shown ? 'none' : 'flex';
  };
  document.getElementById('back-btn').onclick = () => {
    settingsMenu.style.display = 'none';
  };
  document.getElementById('login-btn').onclick    = () => toggleModal(mLogin);
  document.getElementById('register-btn').onclick = () => toggleModal(mRegister);
  backDrop.onclick = () => [mLogin, mRegister, mForgot, backDrop].forEach(el =>
    el.classList.add('oculto')
  );

  // Supabase Auth: Registro
  document.getElementById('register-submit').onclick = async () => {
    const email    = document.getElementById('reg-email').value;
    const pass     = document.getElementById('reg-password').value;
    const confirm  = document.getElementById('reg-confirm-password').value;
    const phone    = document.getElementById('reg-phone').value || null;
    if (pass !== confirm) return alert('Las contrase√±as no coinciden.');

    const { error } = await supabase.auth.signUp({
      email, password: pass, options: { data: { phone } }
    });
    if (error) return alert(error.message);
    toggleModal(mRegister);
    showLogoutOption();
    alert('Cuenta creada e iniciada con √©xito.');
  };

  // Supabase Auth: Login
  document.getElementById('login-submit').onclick = async () => {
    const email = document.getElementById('login-email').value;
    const pass  = document.getElementById('login-password').value;
    const { error } = await supabase.auth.signInWithPassword({ email, password: pass });
    if (error) return alert(error.message);
    toggleModal(mLogin);
    showLogoutOption();
    alert('¬°Bienvenido de nuevo!');
  };

  // Supabase Auth: Logout
  const logoutBtn = document.createElement('button');
  logoutBtn.textContent = 'Cerrar sesi√≥n';
  logoutBtn.id = 'logout-btn-menu';
  logoutBtn.style.display = 'none';
  logoutBtn.classList.add('boton-juego');
  settingsMenu.appendChild(logoutBtn);

  logoutBtn.onclick = async () => {
    await supabase.auth.signOut();
    logoutBtn.style.display = 'none';
    document.getElementById('login-btn').style.display = 'block';
    document.getElementById('register-btn').style.display = 'block';
    alert('Has cerrado sesi√≥n.');
  };

  // Verifica sesi√≥n al cargar
  async function showLogoutOption() {
    const { data: { session } } = await supabase.auth.getSession();
    if (session) {
      logoutBtn.style.display = 'inline-block';
      document.getElementById('login-btn').style.display = 'none';
      document.getElementById('register-btn').style.display = 'none';
    }
  }
  showLogoutOption();

  // Recuperaci√≥n de contrase√±a
  document.getElementById('open-forgot').onclick = () => {
    toggleModal(mLogin);
    toggleModal(mForgot);
  };

  document.getElementById('fog-request-code').onclick = async () => {
    const email = document.getElementById('fog-email').value;
    const phone = document.getElementById('fog-phone').value;

    const { data: user } = await supabase
      .from('profiles')
      .select('id')
      .eq('email', email)
      .eq('phone', phone)
      .single();
    if (!user) return alert('Correo o tel√©fono no coinciden.');

    await fetch('/.netlify/functions/send-reset-code', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, phone })
    });

    document.getElementById('fog-step2').classList.remove('oculto');
    alert('C√≥digo enviado. Revisa tu correo/SMS.');
  };

  document.getElementById('fog-verify-code').onclick = async () => {
    const email = document.getElementById('fog-email').value;
    const code  = document.getElementById('fog-code').value;

    const res = await fetch('/.netlify/functions/verify-code', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, code })
    });
    const { valid } = await res.json();
    if (!valid) return alert('C√≥digo incorrecto.');

    await supabase.auth.resetPasswordForEmail(email, {
      redirectTo: location.origin + '/reset-password.html'
    });
    toggleModal(mForgot);
    alert('C√≥digo verificado. Revisa tu correo para cambiar tu contrase√±a.');
  };

  // Descarga con alerta
  document.querySelectorAll('.descargar').forEach(btn => {
    btn.onclick = e => {
      e.preventDefault();
      alert('Este proyecto a√∫n est√° en desarrollo.\nPr√≥ximamente ‚ÄúCreative Engine‚Äù para que t√∫ tambi√©n crees tu mundo.');
      window.location.href = 'creative-engine.html';
    };
  });

  function toggleForm(id) {
    document.getElementById(id).classList.toggle('mostrar');
  }

  // Chat: Carley Bot
  const chatWidget   = document.getElementById('chat-widget');
  const openBtn      = document.getElementById('chat-open-btn');
  const closeBtn     = document.getElementById('chat-close-btn');
  const sendBtn      = document.getElementById('chat-send-btn');
  const inputField   = document.getElementById('chat-input-field');
  const messagesEl   = document.getElementById('chat-messages');

  openBtn.onclick  = () => chatWidget.classList.remove('oculto');
  closeBtn.onclick = () => chatWidget.classList.add('oculto');

  function appendMessage(text, isBot = false) {
    const msg = document.createElement('div');
    msg.className = isBot ? 'msg bot' : 'msg user';
    msg.textContent = text;
    messagesEl.appendChild(msg);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  function getBotResponse(txt) {
    const msg = txt.toLowerCase();
    
    if (msg.includes('recuper') && msg.includes('cuenta')) {
      return 'Para recuperar su contrasena dirigese a comfiguracion, si estas con la sesion inisiada presiona serrar sesion, luego iniciarsesion y por ultimo presiona me olvide de mi contrasena, poner los datos y listo se le mandara un codigo con la cual podras cambiar su contrasena, puedo ayudarte en otra cosea?';
    }
    if (msg.includes('whatsapp')) {
      return '√önete a nuestro canal: https://whatsapp.com/channel/0029Vao9B2OJP21CsSXDHL20';
    }
    if (msg.includes('proyecto') || msg.includes('objetivo')) {
      return 'Desarrollamos juegos como Fire at Will y estamos creando Creative Engine para que t√∫ tambi√©n dise√±es tu propio mundo.';
    }
    if (msg.includes('recuperar') && msg.includes('cuenta')) {
    return 'Pulsa "¬øOlvidaste tu contrase√±a?" y sigue los pasos para recuperar tu cuenta.';
  }

  if (msg.includes('descargar') && msg.includes('fire at will')) {
    return 'Fire at Will estar√° disponible en Android y se lanzar√° en 2025. ¬°Prep√°rate para la acci√≥n!';
  }

  if (msg.includes('descargar') && msg.includes('the battle')) {
    return 'The Battle of the Capsurers estar√° disponible en Android. ¬°Explora su mundo multijugador!';
  }

  if (msg.includes('la rep√∫blica')) {
    return 'La Rep√∫blica est√° en desarrollo. Pronto habr√° noticias sobre su lanzamiento.';
  }

  if (msg.includes('power force')) {
    return 'Power Force est√° en preparaci√≥n. ¬°Mantente atento para conocer m√°s detalles!';
  }

  if (msg.includes('creative engine') || msg.includes('motor') || msg.includes('engine')) {
    return 'Creative Engine es nuestro motor con IA para que dise√±es tus propios videojuegos. ¬°Muy pronto!';
  }

  if (msg.includes('cu√°ndo') && msg.includes('sale')) {
    return 'Nuestros juegos principales est√°n planeados para lanzarse en 2025.';
  }

  if (msg.includes('iniciar sesi√≥n') || msg.includes('login') || msg.includes('entrar')) {
    return 'Presiona el icono ‚öôÔ∏è, luego "Iniciar sesi√≥n" e ingresa tu correo y contrase√±a.';
  }

  if (msg.includes('crear cuenta') || msg.includes('registro') || msg.includes('registrarme')) {
    return 'Haz clic en ‚öôÔ∏è ‚Üí "Crear cuenta" y completa los campos para registrarte.';
  }

  if (msg.includes('hola') || msg.includes('buenas') || msg.includes('saludos')) {
    return '¬°Hola! Soy Carley Bot. ¬øEn qu√© puedo ayudarte hoy?';
  }

  if (msg.includes('gracias') || msg.includes('thank you')) {
    return '¬°Gracias a ti! Estoy para ayudarte cuando quieras üòä';
  }

  if (msg.includes('qui√©n eres') || msg.includes('como te llamas') || msg.includes('cual es tu nombre')) {
    return 'Soy Carley Bot, el asistente de Carley Interactive Studio. ¬°Un gusto conocerte!';
  }

  if (msg.includes('ayuda') || msg.includes('comandos') || msg.includes('puedes hacer')) {
    return 'Puedo ayudarte con descargas, inicio de sesi√≥n, soporte y responder dudas sobre nuestros juegos.';
  }

  if (msg.includes('adi√≥s') || msg.includes('nos vemos') || msg.includes('hasta luego')) {
    return '¬°Hasta pronto! Si me necesitas, estar√© por aqu√≠ üëã';
  }

  if (msg.includes('redes sociales') || msg.includes('facebook') || msg.includes('youtube')) {
    return 'Puedes seguirnos en YouTube, Facebook y WhatsApp. Los enlaces est√°n justo aqu√≠ abajo üëá';
  }

  if (msg.includes('t√©rminos') || msg.includes('condiciones') || msg.includes('licencia')) {
    return 'Puedes consultar nuestros T√©rminos de Uso y pol√≠tica de privacidad al final de la p√°gina.';
  }

  if (msg.includes('contacto') || msg.includes('soporte') || msg.includes('problema')) {
    return 'Env√≠a un mensaje usando el formulario de soporte debajo de cada juego, o escr√≠benos directamente.';
  }

  if (msg.includes('creador') || msg.includes('qui√©n te cre√≥') || msg.includes('john')) {
    return 'Fui creado por John Carley, fundador de Carley Interactive Studio. üî•';
  }

  if (msg.includes('chiste') || msg.includes('hazme re√≠r')) {
    return '¬øPor qu√© los programadores confunden Halloween con Navidad? Porque OCT 31 = DEC 25 üéÉ‚û°Ô∏èüéÑ';
  }

  if (msg.includes('facebook') && msg.includes('grupo')) {
    return '√önete a nuestro grupo en Facebook para compartir ideas, memes y conocer a otros jugadores: https://facebook.com/groups/carleyJuego';
  }
    if (msg.includes('creador') || msg.includes('due√±')) {
      return 'Fui creado por John Carley, el genio detras de Carley Interactive Studio';
    }
    if (msg.includes('hola') || msg.includes('buen')) {
      return '¬°Hola! Soy Carley Bot. ¬øEn qu√© puedo ayudarte?';
    }
    return 'Lo siento, su pregunta va mas alla de mi capacidad y conosimiento, puedes contactar a mi creador y hacer su pregunta. Puedo ayudarte con recuperaci√≥n de cuenta, WhatsApp, proyectos o informaci√≥n general.';
  }

  sendBtn.onclick = () => {
    const text = inputField.value.trim();
    if (!text) return;
    appendMessage(text, false);
    inputField.value = '';
    setTimeout(() => {
      appendMessage(getBotResponse(text), true);
    }, 300);
  };

  inputField.addEventListener('keypress', e => {
    if (e.key === 'Enter') sendBtn.click();
  });
</script>
</body>
</html>